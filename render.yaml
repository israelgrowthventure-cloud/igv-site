services:
  # Backend CMS/CRM (Python FastAPI + MongoDB)
  - type: web
    name: igv-cms-backend
    runtime: python
    plan: free
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: uvicorn server:app --host 0.0.0.0 --port $PORT
    rootDir: backend
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.4
      - key: MONGODB_URI
        sync: false
      - key: MONGO_URL
        sync: false
      - key: DB_NAME
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: CORS_ALLOWED_ORIGINS
        value: https://israelgrowthventure.com
      - key: CORS_ORIGINS
        value: https://israelgrowthventure.com
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASSWORD
        sync: false
      - key: SMTP_FROM
        sync: false
      - key: BOOTSTRAP_TOKEN
        generateValue: true
      - key: MONETICO_MODE
        value: TEST
      - key: MONETICO_TPE
        sync: false
      - key: MONETICO_KEY
        sync: false
      - key: MONETICO_COMPANY_CODE
        sync: false
      - key: MONETICO_VERSION
        value: "3.0"
      - key: S3_BUCKET
        sync: false
      - key: S3_REGION
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
    healthCheckPath: /api/health
    autoDeploy: true

  # Frontend (React 19 + TailwindCSS + shadcn/ui)
  - type: web
    name: igv-frontend
    runtime: node
    plan: free
    buildCommand: npm ci && npm run build
    staticPublishPath: build
    rootDir: frontend
    envVars:
      - key: NODE_VERSION
        value: 20.18.3
      - key: NODE_ENV
        value: production
      - key: REACT_APP_API_URL
        value: https://igv-cms-backend.onrender.com
      - key: GENERATE_SOURCEMAP
        value: false
      - key: CI
        value: false
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /static/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
    customDomains:
      - israelgrowthventure.com
      - www.israelgrowthventure.com
    autoDeploy: true
